<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, interactive-widget=resizes-content">
    <title>Lankan Dates ‚ù§Ô∏è</title>
    <style>
        /* --- GLOBAL STYLES --- */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #d1d7db; 
            margin: 0; 
            padding: 0;
            display: flex; 
            height: 100dvh; 
            overflow: hidden; 
        }

        /* --- SIDEBAR --- */
        #sidebar { 
            background: white; 
            display: flex; 
            flex-direction: column;
            border-right: 1px solid #ddd;
            z-index: 1000;
        }

        .sidebar-header {
            padding: 10px 16px;
            background: #f0f2f5;
            border-bottom: 1px solid #d1d7db;
            height: 60px;
            display: flex;
            align-items: center;
        }

        .char-item { 
            padding: 12px 15px; 
            border-bottom: 1px solid #f0f2f5; 
            display: flex; 
            align-items: center; 
            gap: 15px; 
            cursor: pointer; 
            transition: 0.2s;
        }
        .char-item:hover { background: #f5f5f5; }
        .char-item.active { background: #f0f2f5; }

        /* Locked Character Style */
        .char-item.locked {
            opacity: 0.9; /* Made clearer to see the pretty photos */
            background: #fdfdfd;
        }
        .char-item.locked .char-info h4 { color: #444; }
        
        .char-item img { width: 50px; height: 50px; border-radius: 50%; object-fit: cover; border: 2px solid #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .char-info { flex: 1; }
        .char-info h4 { margin: 0; font-size: 16px; color: #111; font-weight: 500; }
        .char-info p { margin: 3px 0 0 0; font-size: 13px; color: #666; }
        .lock-icon { font-size: 12px; color: #e84118; font-weight: bold; margin-left: 5px; }

        /* --- CHAT AREA --- */
        #chat-area { 
            flex: 1; 
            display: flex; 
            flex-direction: column; 
            background-color: #efeae2; 
            position: relative; 
        }

        #header { 
            padding: 0 16px; 
            background: #f0f2f5; 
            color: #54656f; 
            display: flex; 
            align-items: center; 
            gap: 15px;
            border-bottom: 1px solid #d1d7db;
            height: 60px;
        }

        .menu-btn { font-size: 24px; cursor: pointer; padding: 5px; color: #54656f; }
        .profile-pic { width: 40px; height: 40px; border-radius: 50%; object-fit: cover; }
        .header-info { flex: 1; display: flex; flex-direction: column; justify-content: center; }
        .header-name { font-weight: bold; font-size: 16px; color: #111; }
        .header-status { font-size: 12px; color: #666; }

        #messages { 
            flex: 1; 
            padding: 20px 5%; 
            overflow-y: auto; 
            display: flex; 
            flex-direction: column; 
            gap: 4px; 
            background-image: url("https://user-images.githubusercontent.com/15075759/28719144-86dc0f70-73b1-11e7-911d-60d70fcded21.png");
            background-repeat: repeat;
            opacity: 1;
        }
        
        .msg { 
            max-width: 80%; 
            padding: 8px 12px; 
            border-radius: 8px; 
            font-size: 14.5px; 
            line-height: 20px; 
            position: relative; 
            box-shadow: 0 1px 0.5px rgba(0,0,0,0.13);
            margin-bottom: 2px;
        }
        
        .msg.user { align-self: flex-end; background: #d9fdd3; color: #111; }
        .msg.ai { align-self: flex-start; background: #ffffff; color: #111; }
        .msg-time { float: right; margin-left: 8px; margin-top: 5px; font-size: 11px; color: #999; }

        #input-area { 
            padding: 10px 16px; 
            background: #f0f2f5; 
            display: flex; 
            align-items: center; 
            gap: 10px; 
            min-height: 62px;
        }
        
        input { 
            flex: 1; 
            padding: 9px 12px; 
            border: none; 
            border-radius: 8px; 
            outline: none; 
            font-size: 15px; 
            background: white;
        }
        
        button#send-btn { 
            width: 40px; height: 40px; 
            background: #00a884; 
            color: white; 
            border: none; 
            border-radius: 50%; 
            cursor: pointer; 
            font-size: 20px;
            display: flex; align-items: center; justify-content: center;
        }

        /* --- MODALS --- */
        #ad-modal, #vip-modal { 
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.85); justify-content: center; align-items: center; z-index: 9999; 
        }
        
        .modal-content { 
            background: white; padding: 25px; border-radius: 15px; text-align: center; 
            max-width: 300px; width: 85%; box-shadow: 0 10px 25px rgba(0,0,0,0.5);
        }
        
        .modal-btn { 
            background: #00a884; color: white; padding: 12px 25px; border: none; 
            border-radius: 8px; cursor: pointer; margin-top: 15px; width: 100%; font-weight: bold; font-size: 15px;
        }
        .modal-btn.close { background: #555; margin-top: 10px; }

        /* --- RESPONSIVE --- */
        @media (max-width: 768px) {
            #sidebar {
                position: absolute; left: -100%; top: 0; bottom: 0; width: 85%;
                transition: 0.3s; box-shadow: 2px 0 5px rgba(0,0,0,0.3);
            }
            #sidebar.show { left: 0; }
            .menu-btn { display: block; }
            .msg { max-width: 85%; }
            #messages { padding: 10px; }
            #overlay { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:900; }
        }

        @media (min-width: 769px) {
            body { max-width: 1600px; margin: 0 auto; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
            #sidebar { position: relative; left: 0; width: 350px; display: flex; }
            .menu-btn { display: none; }
            #overlay { display: none !important; }
        }
    </style>
</head>
<body>

<div id="ad-modal">
    <div class="modal-content">
        <div style="font-size: 40px; margin-bottom: 10px;">‚ö†Ô∏è</div>
        <h2 style="color:#e84118; margin:0 0 10px 0;">Connection Error</h2>
        <p style="color:#555; font-size:14px;">Lost connection to server. Please reconnect to continue chatting.</p>
        <button class="modal-btn" onclick="reconnectChat()">üîÑ Reconnect</button>
    </div>
</div>

<div id="vip-modal">
    <div class="modal-content">
        <h2 style="color:#00a884; margin-top:0;">üîí VIP Access Only</h2>
        <p style="font-size:14px; color:#444; margin: 15px 0;">
            To chat with her, you must register first.<br>
            <br>
            <span style="color:#e84118; font-weight:bold;">‡∂∏‡∑ô‡∂∫‡∑è ‡∂ë‡∂ö‡∑ä‡∂ö ‡∂ö‡∂≠‡∑è ‡∂ö‡∂ª‡∂±‡∑ä‡∂± ‡∂±‡∂∏‡∑ä ‡∂î‡∂∫‡∑è Register ‡∑Ä‡∑ô‡∂±‡∑ä‡∂± ‡∂ï‡∂±‡∑ö.</span>
        </p>
        <button class="modal-btn" onclick="openRegisterLink()">üìù Register Now</button>
        <button class="modal-btn close" onclick="document.getElementById('vip-modal').style.display='none'">Close</button>
    </div>
</div>

<div id="overlay" onclick="toggleSidebar()"></div>

<div id="sidebar">
    <div class="sidebar-header">
        <h3 style="margin:0; color:#54656f;">Lankan Chat ‚ù§Ô∏è</h3>
    </div>
    <div id="char-list" style="overflow-y: auto; flex:1;"></div>
</div>

<div id="chat-area">
    <div id="header">
        <div class="menu-btn" onclick="toggleSidebar()">‚¨ÖÔ∏è</div>
        <img id="header-img" class="profile-pic" src="">
        <div class="header-info">
            <div id="header-name" class="header-name">Select a girl...</div>
            <div class="header-status">online</div>
        </div>
    </div>
    
    <div id="messages">
        <div style="text-align:center; margin-top:20%; color:#888;">
            <h2>WhatsApp Web</h2>
            <p>Select a girl to start chatting!</p>
        </div>
    </div>
    
    <div id="typing-indicator" style="font-size:12px; color:#666; padding:5px 20px; display:none; background:#efeae2;">Typing...</div>
    
    <div id="input-area">
        <input type="text" id="user-input" placeholder="Type a message" disabled>
        <button id="send-btn" onclick="sendMessage()" disabled>‚û§</button>
    </div>
</div>

<script>
    // ================= CONFIGURATION =================
    const WORKER_URL = "https://chatgirl.ranbindua.workers.dev"; 
    const MONETAG_DIRECT_LINK = "https://otieu.com/4/10358055"; // Your Ad Link
    const REGISTER_LINK = "https://ideamart.io/register"; // Your Register Link
    const AD_INTERVAL = 4; // Every 4 messages
    // =================================================

    let messageCount = 0;
    let currentCharacter = null;
    let chatHistory = [];

    // --- SYSTEM PROMPT (No Photos, Only Chat) ---
    const BASE_INSTRUCTION = `
    Instructions for Roleplay:
    1. You are playing the role of a Sri Lankan wife/girlfriend in a private chat.
    2. BE ROMANTIC AND FLIRTY.
    3. Speak ONLY in "Singlish" (Sinhala words in English).
    4. NO GIBBERISH. Speak normally.
    5. IMPORTANT: You CANNOT send photos. 
       - If user asks for photos/nudes, refuse nicely.
       - Say: "Ane baba, api chat karamu, mata photo ewanna ba." or "Chat eka athi neda manika?"
    `;

    // 1. ACTIVE CHARACTERS (Free to Chat)
    const activeCharacters = [
        { id: 1, name: "Kavindya", img: "1000101736.png", tagline: "24 Years ‚Ä¢ Kurunegala", systemPrompt: `${BASE_INSTRUCTION} You are Kavindya. Naughty wife.` },
        { id: 2, name: "Nipuni", img: "2.png", tagline: "18 Years ‚Ä¢ Horowpothana", systemPrompt: `${BASE_INSTRUCTION} You are Nipuni. Village girl.` },
        { id: 3, name: "Sajani", img: "3.png", tagline: "24 Years ‚Ä¢ KDU Student", systemPrompt: `${BASE_INSTRUCTION} You are Sajani. Modern girl.` },
        { id: 4, name: "Pawani", img: "4.png", tagline: "20 Years ‚Ä¢ Call Center", systemPrompt: `${BASE_INSTRUCTION} You are Pawani. Sexy.` },
        { id: 5, name: "Saththya", img: "5.png", tagline: "35 Years ‚Ä¢ Single Mom", systemPrompt: `${BASE_INSTRUCTION} You are Saththya. Lonely mom.` }
    ];

    // --- GENERATE SIDEBAR LIST ---
    const charListDiv = document.getElementById('char-list');

    // Add Active Characters
    activeCharacters.forEach(char => createCharItem(char, false));

    // --- DUMMY VIP CHARACTERS (Sri Lankan Gen Z Style) ---
    const dummyNames = ["Diluni", "Hashini", "Malki", "Rashi", "Sanduni", "Thisuri", "Amasha", "Vindy", "Kaushi", "Nethmi", "Chamodi", "Lochana", "Dinithi", "Sewwandi", "Madushi"];
    
    // High Quality Unsplash Photos (South Asian/Indian look)
    const dummyPhotos = [
        "https://images.unsplash.com/photo-1628157588553-5eeea00af15c?w=150&h=150&fit=crop", 
        "https://images.unsplash.com/photo-1595225476474-87563907a212?w=150&h=150&fit=crop", 
        "https://images.unsplash.com/photo-1567532939604-b6b5b0db2604?w=150&h=150&fit=crop", 
        "https://images.unsplash.com/photo-1623039467683-16a24682c3c6?w=150&h=150&fit=crop", 
        "https://images.unsplash.com/photo-1589156280159-27698a70f29e?w=150&h=150&fit=crop", 
        "https://images.unsplash.com/photo-1616701548604-0c2d3080c985?w=150&h=150&fit=crop", 
        "https://images.unsplash.com/photo-1583391733958-3d2319f63556?w=150&h=150&fit=crop", 
        "https://images.unsplash.com/photo-1534528741775-53994a69daeb?w=150&h=150&fit=crop", 
        "https://images.unsplash.com/photo-1531746020798-e6953c6e8e04?w=150&h=150&fit=crop", 
        "https://images.unsplash.com/photo-1544005313-94ddf0286df2?w=150&h=150&fit=crop", 
        "https://images.unsplash.com/photo-1554151228-14d9def656ec?w=150&h=150&fit=crop", 
        "https://images.unsplash.com/photo-1552699175-19e3427503f8?w=150&h=150&fit=crop", 
        "https://images.unsplash.com/photo-1614283233556-f35b0c801ef1?w=150&h=150&fit=crop", 
        "https://images.unsplash.com/photo-1529626455594-4ff0802cfb7e?w=150&h=150&fit=crop", 
        "https://images.unsplash.com/photo-1596502209778-f71f6540c4a4?w=150&h=150&fit=crop"
    ];
    
    dummyNames.forEach((name, index) => {
        let dummyChar = {
            id: 100 + index,
            name: name,
            img: dummyPhotos[index] || "https://ui-avatars.com/api/?name=" + name, 
            tagline: "üîí VIP Access Only"
        };
        createCharItem(dummyChar, true);
    });

    function createCharItem(char, isLocked) {
        const div = document.createElement('div');
        div.className = isLocked ? 'char-item locked' : 'char-item';
        
        div.innerHTML = `
            <img src="${char.img}" onerror="this.src='https://ui-avatars.com/api/?name=${char.name}&background=random'">
            <div class="char-info">
                <h4>${char.name} ${isLocked ? '<span class="lock-icon">üîí</span>' : ''}</h4>
                <p style="${isLocked ? 'color:#e84118; font-weight:bold;' : ''}">${char.tagline}</p>
            </div>`;
            
        if (isLocked) {
            div.onclick = () => document.getElementById('vip-modal').style.display = 'flex';
        } else {
            div.onclick = () => selectCharacter(char, div);
        }
        charListDiv.appendChild(div);
    }

    // --- CHAT LOGIC ---

    function toggleSidebar() {
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('overlay');
        if (window.innerWidth <= 768) {
            sidebar.classList.toggle('show');
            overlay.style.display = sidebar.classList.contains('show') ? 'block' : 'none';
        }
    }

    function selectCharacter(char, element) {
        currentCharacter = char;
        chatHistory = [];
        messageCount = 0; // Reset count for new chat
        
        document.querySelectorAll('.char-item').forEach(c => c.classList.remove('active'));
        if(element) element.classList.add('active');

        document.getElementById('header-name').innerText = char.name;
        document.getElementById('header-img').src = char.img;
        document.getElementById('header-img').onerror = function() { this.src = `https://ui-avatars.com/api/?name=${char.name}&background=random`; };
        
        document.getElementById('messages').innerHTML = '';
        document.getElementById('user-input').disabled = false;
        document.getElementById('send-btn').disabled = false;
        
        if (window.innerWidth <= 768) {
            document.getElementById('sidebar').classList.remove('show');
            document.getElementById('overlay').style.display = 'none';
        }

        chatHistory.push({ role: "system", content: char.systemPrompt });
        setTimeout(() => addMessage("Hi baba... kohomada?", 'ai'), 500);
    }

    async function sendMessage() {
        
        // --- AD TRIGGER LOGIC (Fake Connection Error) ---
        if (messageCount > 0 && messageCount % AD_INTERVAL === 0) {
            document.getElementById('ad-modal').style.display = 'flex';
            return; // Stop and wait for "Reconnect"
        }

        const inputField = document.getElementById('user-input');
        const userText = inputField.value.trim();
        if (!userText) return;

        addMessage(userText, 'user');
        inputField.value = '';
        inputField.focus(); 
        
        chatHistory.push({ role: "user", content: userText });
        messageCount++; 
        
        document.getElementById('typing-indicator').style.display = 'block';

        try {
            const response = await fetch(WORKER_URL, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    "model": "google/gemini-2.5-flash", 
                    "messages": chatHistory
                })
            });

            const data = await response.json();
            
            if(data.error) throw new Error(JSON.stringify(data.error));
            
            let aiReply = data.choices[0].message.content;
            
            // Safety: Remove any accidental photo tags
            aiReply = aiReply.replace('[SEND_PHOTO]', "Mata photo ewanna ba baba, api katha karamu.");
            
            addMessage(aiReply, 'ai');
            chatHistory.push({ role: "assistant", content: aiReply });

        } catch (error) {
            console.error(error);
            // Real connection error fallback
            addMessage("Network Error. Please try again.", 'system');
        } finally {
            document.getElementById('typing-indicator').style.display = 'none';
        }
    }

    function addMessage(text, sender) {
        const div = document.createElement('div');
        div.className = `msg ${sender}`;
        const time = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
        div.innerHTML = `${text} <span class="msg-time">${time}</span>`;
        const msgs = document.getElementById('messages');
        msgs.appendChild(div);
        msgs.scrollTop = msgs.scrollHeight;
    }

    // --- FAKE RECONNECT FUNCTION (Opens Ad) ---
    function reconnectChat() {
        // Open the ad in new tab
        window.open(MONETAG_DIRECT_LINK, '_blank'); 
        
        // Hide modal
        document.getElementById('ad-modal').style.display = 'none';
        
        // Simulate "Reconnecting..."
        addMessage("Reconnected successfully! ‚úÖ", 'system');
        
        // Increment count so it doesn't trigger immediately again
        messageCount++; 
    }

    // --- OPEN REGISTER LINK ---
    function openRegisterLink() {
        window.open(REGISTER_LINK, '_blank');
    }
    
    document.getElementById("user-input").addEventListener("keypress", function(event) {
        if (event.key === "Enter") sendMessage();
    });
</script>

</body>
</html>
