<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lankan Dates ‚ù§Ô∏è</title>
    <style>
        /* --- DESIGN STYLES --- */
        body { font-family: 'Segoe UI', sans-serif; background-color: #f0f2f5; margin: 0; display: flex; height: 100vh; overflow: hidden; }
        
        /* Sidebar Styles */
        #sidebar { width: 300px; background: white; border-right: 1px solid #ddd; padding: 15px; display: flex; flex-direction: column; overflow-y: auto; }
        .app-title { text-align: center; color: #ff4757; font-size: 24px; margin-bottom: 25px; font-weight: 800; letter-spacing: 1px; }
        
        .character-card { padding: 10px; margin-bottom: 15px; border: 2px solid #f1f1f1; border-radius: 15px; cursor: pointer; display: flex; align-items: center; gap: 15px; transition: 0.2s; background: #fff; }
        .character-card:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.05); border-color: #ffb8b8; }
        .character-card.active { border-color: #ff4757; background: #fff0f3; box-shadow: 0 4px 12px rgba(255, 71, 87, 0.2); }
        
        /* Photo Styles (‡∂ª‡∑Ä‡∑î‡∂∏‡∑ä ‡∑Ñ‡∑ê‡∂©‡∂∫ ‡∑É‡∑Ñ ‡∂¥‡∑ä‚Äç‡∂ª‡∂∏‡∑è‡∂´‡∂∫) */
        .avatar { 
            width: 65px; 
            height: 65px; 
            background: #eee; 
            border-radius: 50%; 
            object-fit: cover; 
            border: 2px solid #fff; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.1); 
        }
        
        .char-info h4 { margin: 0; font-size: 16px; color: #333; font-weight: 700; }
        .char-info p { margin: 4px 0 0 0; font-size: 12px; color: #777; }

        /* Chat Area */
        #chat-area { flex: 1; display: flex; flex-direction: column; background: #fff; position: relative; }
        #header { padding: 15px 20px; background: linear-gradient(90deg, #ff4757, #ff6b81); color: white; font-weight: bold; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        #messages { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 12px; background: #f9f9f9; padding-bottom: 80px; }
        
        .msg { max-width: 75%; padding: 12px 18px; border-radius: 20px; font-size: 15px; line-height: 1.5; box-shadow: 0 1px 2px rgba(0,0,0,0.05); }
        .msg.user { align-self: flex-end; background: #0084ff; color: white; border-bottom-right-radius: 5px; }
        .msg.ai { align-self: flex-start; background: #ffffff; color: #333; border-bottom-left-radius: 5px; border: 1px solid #eee; }

        /* Input Area */
        #input-area { padding: 15px; border-top: 1px solid #ddd; display: flex; gap: 10px; background: white; }
        input { flex: 1; padding: 15px; border: 1px solid #ddd; border-radius: 30px; outline: none; font-size: 16px; }
        button#send-btn { padding: 0 25px; background: #ff4757; color: white; border: none; border-radius: 30px; cursor: pointer; font-weight: bold; }

        /* Premium Photos */
        .photo-container { position: relative; max-width: 280px; border-radius: 15px; overflow: hidden; margin-top: 5px; border: 3px solid #ff4757; background: #000; }
        .photo-blur { width: 100%; height: 380px; object-fit: cover; filter: blur(30px); opacity: 0.7; }
        .photo-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); display: flex; flex-direction: column; justify-content: center; align-items: center; color: white; text-align: center; }
        .unlock-btn { background: linear-gradient(45deg, #e84118, #c23616); color: white; padding: 12px 24px; border: none; border-radius: 25px; font-weight: bold; cursor: pointer; margin-top: 15px; }
        .unlocked .photo-blur { filter: blur(0); opacity: 1; }
        .unlocked .photo-overlay { display: none; }

        /* Modals */
        #ad-modal, #password-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); display: none; justify-content: center; align-items: center; z-index: 9999; backdrop-filter: blur(5px); }
        .modal-content { background: white; padding: 30px; border-radius: 20px; text-align: center; max-width: 320px; box-shadow: 0 10px 25px rgba(0,0,0,0.2); }
        .modal-btn { background: #0084ff; color: white; padding: 12px 25px; border: none; border-radius: 8px; cursor: pointer; margin-top: 20px; width: 100%; font-weight: bold; }

        @media (max-width: 600px) {
            #sidebar { display: none; position: absolute; width: 85%; height: 100%; box-shadow: 5px 0 15px rgba(0,0,0,0.2); }
            #sidebar.show { display: flex; }
            .menu-toggle { display: block; margin-right: 15px; cursor: pointer; font-size: 24px; }
        }
        @media (min-width: 601px) { .menu-toggle { display: none; } }
    </style>
</head>
<body>

<div id="ad-modal">
    <div class="modal-content">
        <h2 style="color:#ff4757; margin-top:0;">‚ö†Ô∏è She is busy!</h2>
        <p style="color:#666;">Too many messages. Reconnect to continue chatting.</p>
        <button class="modal-btn" onclick="watchAdAndReconnect()">üîÑ Reconnect Now</button>
    </div>
</div>

<div id="password-modal">
    <div class="modal-content">
        <h3>üîê Unlock Photos</h3>
        <input type="text" id="secret-code" placeholder="Enter Code Here..." style="width: 80%; padding:10px; text-align:center; border:1px solid #ddd; border-radius:5px;">
        <button class="modal-btn" style="background:#2ed573;" onclick="checkCode()">Unlock</button>
        <button class="modal-btn" style="background:#555; margin-top:10px;" onclick="document.getElementById('password-modal').style.display='none'">Cancel</button>
    </div>
</div>

<div id="sidebar">
    <div class="app-title">Lankan Dates ‚ù§Ô∏è</div>
    <div id="char-list"></div>
    <div style="margin-top:20px; text-align:center;">
        <button onclick="enterCodePopup()" style="background:none; border:none; color:#0084ff; text-decoration:underline; cursor:pointer;">I have a Premium Code</button>
    </div>
</div>

<div id="chat-area">
    <div id="header">
        <div style="display:flex; align-items:center;">
            <div class="menu-toggle" onclick="toggleSidebar()">‚ò∞</div>
            <span id="header-name">Select a girl...</span>
        </div>
        <span id="premium-badge" style="display:none; background:#ffd32a; color:black; padding:5px 12px; border-radius:20px; font-size:12px; font-weight:800;">üëë VIP</span>
    </div>
    
    <div id="messages">
        <div style="text-align:center; color:#aaa; margin-top:50px;">
            <p>üëà Select a girl to start chatting!</p>
        </div>
    </div>
    
    <div id="typing-indicator" style="font-size:12px; color:#888; padding:0 20px; display:none;">Typing...</div>
    
    <div id="input-area">
        <input type="text" id="user-input" placeholder="Type a message..." disabled>
        <button id="send-btn" onclick="sendMessage()" disabled>Send</button>
    </div>
</div>

<script>
    // ================= CONFIGURATION =================
    const WORKER_URL = "https://chatgirl.ranbindua.workers.dev"; 
    const MONETAG_URL = "https://your-monetag-link.com"; 
    const PAYMENT_LINK = "https://wa.me/94700000000?text=I%20want%20premium"; 
    const SECRET_UNLOCK_CODE = "LOVE2026"; 
    // =================================================

    let messageCount = 0;
    let isPremium = false;
    let currentCharacter = null;
    let chatHistory = [];

    // --- CHARACTER DATA (‡∂î‡∂∫‡∑è‡∂ú‡∑ö ‡∑Ü‡∑ú‡∂ß‡∑ù ‡∂±‡∂∏‡∑ä ‡∑É‡∑Ñ ‡∑Ñ‡∂ª‡∑í ‡∂±‡∂∏‡∑ä ‡∂ë‡∂ö‡∑ä‡∂ö) ---
    const characters = [
        {
            id: 1, 
            name: "Kavindya",  // ‡∂±‡∂∏ ‡∑Ä‡∑í‡∂≠‡∂ª‡∂∫‡∑í
            img: "1000101736.jpg", // ‡∂î‡∂∫‡∑è ‡∂ë‡∑Ä‡∂¥‡∑î ‡∂î‡∂ª‡∑í‡∂¢‡∑í‡∂±‡∂Ω‡∑ä ‡∑Ü‡∑ú‡∂ß‡∑ù ‡∂ë‡∂ö
            tagline: "24 Years ‚Ä¢ Kurunegala",
            photos: ["1000101736.jpg"], 
            systemPrompt: `You are Kavindya. 
            LANGUAGE RULE: Speak ONLY in "Singlish" (Sinhala words in English letters). Do not speak formal English.
            Example: "Ane man ada busy una baba", "Oya kewa da?", "Mata paalui".
            Personality: You are an HR student. Outwardly innocent, inwardly ambitious.
            IMPORTANT: If asked for a photo/nude/kukku, reply EXACTLY: "[SEND_PHOTO]".`
        },
        {
            id: 2, 
            name: "Nipuni", 
            img: "2.jpg", 
            tagline: "18 Years ‚Ä¢ Horowpothana",
            photos: ["2.jpg"],
            systemPrompt: `You are Nipuni. 
            LANGUAGE RULE: Speak ONLY in "Singlish". Use village words like "Ane", "Iyoo", "Aiye".
            Example: "Ane aiye mata bayai", "Amma baninawa", "Oya hari narakai".
            Personality: Innocent village girl, looking for first love.
            IMPORTANT: If asked for a photo/nude/kukku, reply EXACTLY: "[SEND_PHOTO]".`
        },
        {
            id: 3, 
            name: "Sajani", 
            img: "3.jpg", 
            tagline: "24 Years ‚Ä¢ KDU Student",
            photos: ["3.jpg"],
            systemPrompt: `You are Sajani. 
            LANGUAGE RULE: Speak ONLY in "Singlish". Be strict and direct.
            Example: "Boru kiyanna epa oya", "Moko parakku?", "Kewada kiyala kiyanna".
            Personality: Law student. Strict, hates lies. Protective but bossy.
            IMPORTANT: If asked for a photo/nude/kukku, reply EXACTLY: "[SEND_PHOTO]".`
        },
        {
            id: 4, 
            name: "Pawani", 
            img: "4.jpg", 
            tagline: "20 Years ‚Ä¢ Call Center",
            photos: ["4.jpg"],
            systemPrompt: `You are Pawani. 
            LANGUAGE RULE: Speak ONLY in "Singlish". Use slang and flirtatious words.
            Example: "Moko wenne handsome?", "Ada reta free da?", "Kammali ane".
            Personality: Naughty, flirtatious, high energy.
            IMPORTANT: If asked for a photo/nude/kukku, reply EXACTLY: "[SEND_PHOTO]".`
        },
        {
            id: 5, 
            name: "Saththya", 
            img: "5.jpg", 
            tagline: "35 Years ‚Ä¢ Single Mom",
            photos: ["5.jpg"],
            systemPrompt: `You are Saththya. 
            LANGUAGE RULE: Speak ONLY in "Singlish". Talk like a mature woman.
            Example: "Mata den thanikama purudui", "Oya wage kenek labenna pin karanna oni", "Rata hari paalui".
            Personality: Single mom, lonely, craving intimacy.
            IMPORTANT: If asked for a photo/nude/kukku, reply EXACTLY: "[SEND_PHOTO]".`
        }
    ];

    // --- SETUP SIDEBAR ---
    const charListDiv = document.getElementById('char-list');
    characters.forEach(char => {
        const div = document.createElement('div');
        div.className = 'character-card';
        // ‡∑Ü‡∑ú‡∂ß‡∑ù ‡∂ë‡∂ö Load ‡∑Ä‡∑ô‡∂±‡∑ä‡∂±‡∑ö ‡∂±‡∑ê‡∂≠‡∑ä‡∂±‡∂∏‡∑ä Placeholder ‡∂ë‡∂ö‡∂ö‡∑ä ‡∂Ø‡∑è‡∂±‡∑ä‡∂± ‡∑Ñ‡∂Ø‡∂Ω ‡∂≠‡∑í‡∂∫‡∑ô‡∂±‡∑ä‡∂±‡∑ö
        div.innerHTML = `
            <img src="${char.img}" class="avatar" onerror="this.src='https://ui-avatars.com/api/?name=${char.name}&background=random'">
            <div class="char-info">
                <h4>${char.name}</h4>
                <p>${char.tagline}</p>
            </div>`;
        div.onclick = () => selectCharacter(char, div);
        charListDiv.appendChild(div);
    });

    function selectCharacter(char, element) {
        currentCharacter = char;
        chatHistory = [];
        messageCount = 0;
        
        document.querySelectorAll('.character-card').forEach(c => c.classList.remove('active'));
        element.classList.add('active');
        
        document.getElementById('header-name').innerText = char.name;
        document.getElementById('messages').innerHTML = '';
        document.getElementById('user-input').disabled = false;
        document.getElementById('send-btn').disabled = false;
        
        document.getElementById('sidebar').classList.remove('show');

        // System Prompt ‡∂ë‡∂ö ‡∂∫‡∑Ä‡∂±‡∑Ä‡∑è (Singlish Force ‡∂ö‡∂ª‡∂∏‡∑í‡∂±‡∑ä)
        chatHistory.push({ role: "system", content: char.systemPrompt });
        
        // Welcome Message (‡∑É‡∑í‡∂Ç‡∑Ñ‡∂Ω‡∑ô‡∂±‡∑ä)
        let welcome = "Hi, kohomada?";
        if(char.id === 1) welcome = "Hi baba... Study wada asse oyaw mathak una.";
        if(char.id === 2) welcome = "Ane aiye... mata paalui gedara inna.";
        if(char.id === 3) welcome = "Moko ada parakku? Kewa neda?";
        if(char.id === 4) welcome = "Hey handsome, kammali nadda?";
        if(char.id === 5) welcome = "Ada hari paalui... rata godak digai wage.";
        
        setTimeout(() => addMessage(welcome, 'ai'), 500);
    }

    async function sendMessage() {
        if (!isPremium && messageCount > 0 && messageCount % 5 === 0) {
            document.getElementById('ad-modal').style.display = 'flex';
            return;
        }

        const inputField = document.getElementById('user-input');
        const userText = inputField.value.trim();
        if (!userText) return;

        addMessage(userText, 'user');
        inputField.value = '';
        chatHistory.push({ role: "user", content: userText });
        messageCount++;

        document.getElementById('typing-indicator').style.display = 'block';

        try {
            const response = await fetch(WORKER_URL, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    "model": "gryphe/mythomax-l2-13b",
                    "messages": chatHistory
                })
            });

            const data = await response.json();
            if(data.error) throw new Error(data.error);
            
            let aiReply = data.choices[0].message.content;

            if (aiReply.includes("[SEND_PHOTO]")) {
                sendLockedPhoto();
            } else {
                addMessage(aiReply, 'ai');
                chatHistory.push({ role: "assistant", content: aiReply });
            }

        } catch (error) {
            console.error(error);
            addMessage("Network podi aulak baba. Aaye kiyanna.", 'system');
        } finally {
            document.getElementById('typing-indicator').style.display = 'none';
        }
    }

    function addMessage(text, sender) {
        const div = document.createElement('div');
        div.className = `msg ${sender}`;
        div.innerText = text;
        const msgs = document.getElementById('messages');
        msgs.appendChild(div);
        msgs.scrollTop = msgs.scrollHeight;
    }

    function sendLockedPhoto() {
        const randomPhoto = currentCharacter.photos[Math.floor(Math.random() * currentCharacter.photos.length)];
        const div = document.createElement('div');
        div.className = isPremium ? 'photo-container unlocked' : 'photo-container';
        
        div.innerHTML = `
            <img src="${randomPhoto}" class="photo-blur">
            <div class="photo-overlay">
                <h3>üîû Private Photo</h3>
                <p>She sent a photo.</p>
                <button class="unlock-btn" onclick="redirectToPay()">Unlock Now (Rs. 500)</button>
            </div>
        `;
        const msgs = document.getElementById('messages');
        msgs.appendChild(div);
        msgs.scrollTop = msgs.scrollHeight;
    }

    function toggleSidebar() { document.getElementById('sidebar').classList.toggle('show'); }
    function watchAdAndReconnect() { window.open(MONETAG_URL, '_blank'); document.getElementById('ad-modal').style.display = 'none'; messageCount++; }
    function redirectToPay() { if(confirm("Chat Admin on WhatsApp for code?")) window.open(PAYMENT_LINK, '_blank'); }
    function enterCodePopup() { document.getElementById('password-modal').style.display = 'flex'; }
    function checkCode() {
        if(document.getElementById('secret-code').value === SECRET_UNLOCK_CODE) {
            isPremium = true;
            document.getElementById('password-modal').style.display = 'none';
            document.getElementById('premium-badge').style.display = 'block';
            document.querySelectorAll('.photo-container').forEach(el => el.classList.add('unlocked'));
            alert("Success! All photos unlocked.");
        } else { alert("Wrong Code!"); }
    }
    
    document.getElementById("user-input").addEventListener("keypress", function(event) {
        if (event.key === "Enter") sendMessage();
    });
</script>

</body>
</html>
